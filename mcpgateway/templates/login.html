<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="{{ root_path }}/static/cogentiq.png" />

    <title>Sign In - MCP Gateway</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            animation: {
              "gradient-x": "gradient-x 15s ease infinite",
              float: "float 6s ease-in-out infinite",
              "pulse-soft": "pulse-soft 2s ease-in-out infinite",
              "slide-up": "slide-up 0.8s ease-out",
              "fade-in": "fade-in 1s ease-out",
              "scale-pulse": "scale-pulse 4s ease-in-out infinite",
            },
            keyframes: {
              "gradient-x": {
                "0%, 100%": {
                  "background-size": "200% 200%",
                  "background-position": "left center",
                },
                "50%": {
                  "background-size": "200% 200%",
                  "background-position": "right center",
                },
              },
              float: {
                "0%, 100%": { transform: "translateY(0px)" },
                "50%": { transform: "translateY(-20px)" },
              },
              "pulse-soft": {
                "0%, 100%": { opacity: 1 },
                "50%": { opacity: 0.8 },
              },
              "slide-up": {
                "0%": { transform: "translateY(30px)", opacity: 0 },
                "100%": { transform: "translateY(0)", opacity: 1 },
              },
              "fade-in": {
                "0%": { opacity: 0 },
                "100%": { opacity: 1 },
              },
              "scale-pulse": {
                "0%, 100%": { transform: "scale(1)" },
                "50%": { transform: "scale(1.05)" },
              },
            },
          },
        },
      };
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script>
      // Theme init: default light, respect stored preference
      (function () {
        try {
          const stored = localStorage.getItem("theme");
          const html = document.documentElement;
          if (stored === "dark") {
            html.classList.add("dark");
          } else {
            html.classList.remove("dark");
          }
        } catch (e) {
          // ignore
        }
      })();
    </script>
  </head>
  <body
    class="h-full bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 overflow-hidden"
  >
    <!-- Top header / product bar -->
    <header
      class="absolute top-0 left-0 right-0 z-20 px-6 py-4 flex items-center justify-between pointer-events-none"
    >
      <div class="flex items-center gap-3 pointer-events-auto">
        <img
          src="{{ root_path }}/static/cogentiq.png"
          alt="Cogentiq by Fractal"
          class="h-9 w-auto object-contain"
        />
        <div>
          <p
            class="text-[10px] uppercase tracking-[0.22em] text-slate-500 dark:text-slate-400/90 mb-0.5"
          >
            Cogentiq by Fractal
          </p>
          <p
            class="text-sm font-semibold text-slate-900 dark:text-slate-100"
          >
            MCP &amp; AI Gateway Control Plane
          </p>
        </div>
      </div>
      <div class="flex items-center gap-3 pointer-events-auto">
        <span
          class="px-3 py-1 rounded-full text-[11px] font-medium bg-emerald-50 text-emerald-700 border border-emerald-200 flex items-center gap-1.5 dark:bg-emerald-500/10 dark:text-emerald-300 dark:border-emerald-500/40"
        >
          <span
            class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse-soft"
          ></span>
          Gateway: Online
        </span>
        <span
          class="px-3 py-1 rounded-full text-[11px] bg-slate-100 text-slate-700 border border-slate-200 dark:bg-slate-900/70 dark:text-slate-300 dark:border-slate-700/70"
        >
          Environment: <span class="font-semibold">Staging</span>
        </span>

        <!-- Theme toggle -->
        <button
          id="theme-toggle"
          type="button"
          class="ml-2 inline-flex items-center justify-center w-8 h-8 rounded-full border border-slate-200 bg-white text-slate-600 shadow-sm hover:bg-slate-50 hover:text-slate-900 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-white transition-colors"
        >
          <i id="theme-toggle-sun" class="fas fa-sun text-xs"></i>
          <i
            id="theme-toggle-moon"
            class="fas fa-moon text-xs hidden"
          ></i>
        </button>
      </div>
    </header>

    <!-- Main Split Layout -->
    <div
      class="min-h-screen flex bg-gradient-to-br from-slate-50 via-slate-50 to-slate-100 dark:from-slate-950 dark:via-slate-950 dark:to-slate-900 relative"
    >
      <!-- Soft background aura -->
      <div
        class="pointer-events-none absolute inset-0 bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.18),transparent_55%),radial-gradient(circle_at_80%_20%,rgba(129,140,248,0.16),transparent_60%)] opacity-60 dark:opacity-80"
      ></div>

      <!-- Left Side - Login Form -->
      <div
        class="flex-1 flex flex-col justify-center py-10 px-4 sm:px-8 lg:px-12 relative z-10"
      >
        <!-- Subtle background decoration -->
        <div
          class="absolute inset-0 bg-gradient-to-br from-sky-50 via-blue-50 to-slate-100 dark:from-slate-950/40 dark:via-slate-950/60 dark:to-slate-950/80"
        ></div>

        <div
          class="absolute -top-10 -left-10 w-40 h-40 bg-indigo-200/40 rounded-full blur-3xl animate-float dark:bg-indigo-500/20"
        ></div>
        <div
          class="absolute bottom-10 right-6 w-32 h-32 bg-sky-200/40 rounded-full blur-3xl animate-float dark:bg-sky-500/20"
          style="animation-delay: 2s"
        ></div>

        <div class="sm:mx-auto sm:w-full sm:max-w-md lg:max-w-lg relative z-10">
          <!-- Page hero above card -->
          <div class="mb-6">
          </div>

          <!-- Login Card -->
          <div
            class="bg-white/95 dark:bg-slate-900/80 backdrop-blur-2xl py-6 px-5 sm:px-6 shadow-2xl rounded-2xl border border-slate-200/90 dark:border-slate-700/70 animate-slide-up"
            style="animation-delay: 0.2s"
          >
            <!-- Card header -->
            <div class="mb-6">
              <div
                class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3"
              >
                <div>
                  <p
                    class="text-[11px] uppercase tracking-[0.18em] text-slate-500 dark:text-slate-500 mb-1"
                  >
                    Authentication
                  </p>
                  <h2
                    class="text-sm font-semibold text-slate-900 dark:text-slate-50"
                  >
                    Admin console sign-in
                  </h2>
                  <p class="text-xs text-slate-500 dark:text-slate-400 mt-1.5">
                    Use your enterprise SSO or work email. All logins are
                    audited.
                  </p>
                </div>
                <div
                  class="sm:flex flex-col items-start sm:items-end gap-1 text-left sm:text-right"
                >
                  <span
                    class="px-2 py-0.5 rounded-full text-[10px] font-medium bg-indigo-50 text-indigo-700 border border-indigo-200 dark:bg-indigo-500/10 dark:text-indigo-300 dark:border-indigo-500/40"
                  >
                    Scope: Platform &amp; Ops
                  </span>
                  <span class="text-[10px] text-slate-500 dark:text-slate-500">
                    Privileged access only
                  </span>
                </div>
              </div>
            </div>

            <!-- Error messages -->
            <div
              id="error-message"
              class="mb-5 p-3.5 bg-red-50 border border-red-200 text-red-700 rounded-xl text-xs hidden dark:bg-red-900/15 dark:border-red-500/50 dark:text-red-200"
            >
              <div class="flex items-center">
                <i class="fas fa-exclamation-circle mr-2"></i>
                <span id="error-text"></span>
              </div>
            </div>

            <!-- SSO Providers Section -->
            <div id="sso-section" class="mb-5">
              <p
                class="text-[11px] font-medium text-slate-500 dark:text-slate-400 uppercase tracking-[0.2em] mb-3 text-center"
              >
                Single Sign-On
              </p>
              <div
                class="grid grid-cols-1 sm:grid-cols-2 gap-3"
                id="sso-providers"
              >
                <!-- SSO buttons will be dynamically added here -->
              </div>
            </div>

            <!-- Divider -->
            <div class="relative my-5" id="divider">
              <div class="absolute inset-0 flex items-center">
                <div
                  class="w-full border-t border-slate-200 dark:border-slate-700"
                ></div>
              </div>
              <div class="relative flex justify-center text-[11px]">
                <span
                  class="px-3 bg-white/95 text-slate-500 dark:bg-slate-900/80 dark:text-slate-400 font-medium tracking-[0.18em] uppercase"
                  >Or sign in with work email</span
                >
              </div>
            </div>

            <!-- Email/Password Form -->
            <form
              class="space-y-4"
              action="{{ root_path }}/admin/login"
              method="post"
            >
              <div>
                <label
                  for="email"
                  class="block text-xs font-semibold text-slate-700 dark:text-slate-300 mb-1.5"
                >
                  <i class="fas fa-envelope mr-1.5 text-slate-400"></i>Email
                  address
                </label>
                <div
                  class="group/email relative rounded-lg bg-white border border-slate-300 focus-within:border-indigo-500 focus-within:ring-1 focus-within:ring-indigo-500 dark:bg-slate-900/70 dark:border-slate-700/90 dark:focus-within:bg-slate-900 transition-all"
                >
                  <div
                    class="absolute left-0 inset-y-1 w-0.5 bg-indigo-500 rounded-full opacity-0 group-focus-within/email:opacity-100"
                  ></div>
                  <input
                    id="email"
                    name="email"
                    type="email"
                    autocomplete="email"
                    required
                    placeholder="you@company.com"
                    class="w-full pl-4 pr-3 py-2 border-0 rounded-lg placeholder-slate-400 bg-transparent text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-0"
                  />
                </div>
              </div>

              <div>
                <label
                  for="password"
                  class="block text-xs font-semibold text-slate-700 dark:text-slate-300 mb-1.5"
                >
                  <i class="fas fa-lock mr-1.5 text-slate-400"></i>Password
                </label>
                <div
                  class="relative group/password rounded-lg bg-white border border-slate-300 focus-within:border-indigo-500 focus-within:ring-1 focus-within:ring-indigo-500 dark:bg-slate-900/70 dark:border-slate-700/90 dark:focus-within:bg-slate-900 transition-all"
                >
                  <div
                    class="absolute left-0 inset-y-1 w-0.5 bg-indigo-500 rounded-full opacity-0 group-focus-within/password:opacity-100"
                  ></div>
                  <input
                    id="password"
                    name="password"
                    type="password"
                    autocomplete="current-password"
                    required
                    placeholder="Enter your password"
                    class="w-full pl-4 pr-9 py-2 border-0 rounded-lg placeholder-slate-400 bg-transparent text-sm text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-0"
                  />
                  <button
                    type="button"
                    onclick="togglePassword()"
                    class="absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-slate-600 dark:text-slate-500 dark:hover:text-slate-300"
                  >
                    <i id="password-icon" class="fas fa-eye text-xs"></i>
                  </button>
                </div>
              </div>

              <button
                type="submit"
                class="w-full flex justify-center items-center py-2.5 px-4 bg-gradient-to-r from-indigo-500 via-indigo-400 to-sky-500 hover:from-indigo-400 hover:to-sky-400 text-white text-sm font-semibold rounded-full shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-slate-50 dark:focus:ring-offset-slate-950 transition-all duration-200"
              >
                <i class="fas fa-sign-in-alt mr-2 text-xs"></i>
                Sign In
              </button>
            </form>

            <!-- Footer -->
            <div class="mt-4 text-center">
              <p
                class="text-[11px] text-slate-500 dark:text-slate-500 flex items-center justify-center gap-1.5"
              >
                <i
                  class="fas fa-shield-alt text-slate-500 text-[10px]"
                ></i>
                Authentication events are logged and monitored.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Side - Feature Grid (always brand gradient) -->
      <div
        class="hidden lg:flex flex-1 bg-gradient-to-br from-[#0c2340] via-blue-800 to-[#132d4d] relative overflow-hidden items-center justify-center"
      >
        <!-- Integrated background pattern -->
        <div class="absolute inset-0 opacity-20">
          <div
            class="absolute inset-0"
            style="
              background-image: url('data:image/svg+xml,%3Csvg width=&quot;40&quot; height=&quot;40&quot; viewBox=&quot;0 0 40 40&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;%3E%3Cg fill=&quot;%23ffffff&quot; fill-opacity=&quot;0.08&quot;%3E%3Cpath d=&quot;M20 20c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10zm10 0c0-5.5-4.5-10-10-10s-10 4.5-10 10 4.5 10 10 10 10-4.5 10-10z&quot;/%3E%3C/g%3E%3C/svg%3E');
            "
          ></div>
        </div>

        <!-- Subtle floating accents -->
        <div
          class="absolute top-16 right-16 w-2 h-2 bg-white/40 rounded-full animate-pulse-soft"
        ></div>
        <div
          class="absolute bottom-24 left-16 w-1 h-1 bg-white/40 rounded-full animate-pulse-soft"
          style="animation-delay: 1s"
        ></div>
        <div
          class="absolute top-1/3 right-32 w-1.5 h-1.5 bg-white/35 rounded-full animate-pulse-soft"
          style="animation-delay: 2s"
        ></div>

        <!-- Main content container -->
        <div class="relative z-10 max-w-2xl px-10 py-6 space-y-6">
          <!-- Product title / hero -->
          <div class="text-left mb-1">
            <div class="flex items-center gap-3 mb-3">
              <div
                class="inline-flex items-center justify-center w-10 h-10 bg-slate-950/70 border border-white/20 rounded-2xl shadow-lg shadow-slate-900"
              >
                <img
                  src="{{ root_path }}/static/cogentiq.png"
                  alt="Fractal's MCP Gateway"
                  class="w-6 h-6 rounded-lg"
                  onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';"
                />
                <i
                  class="fas fa-network-wired text-white text-sm"
                  style="display: none"
                ></i>
              </div>
              <div>
                <h1 class="text-[1.5rem] font-semibold text-white tracking-[0.08em]">
                  Cogentiq's MCP & AI Gateway
                </h1>
                <p class="text-sm text-blue-100/85">
                  Unified control plane for MCP, tools and AI agents.
                </p>
              </div>
            </div>
          </div>

          <!-- Core Platform grid -->
          <div class="space-y-3">
            <h3
              class="text-[11px] font-semibold text-blue-200 uppercase tracking-[0.22em] text-center mb-4"
            >
              Core Platform
            </h3>
            <div class="grid grid-cols-3 gap-3">
              <!-- Federation -->
              <div
                class="bg-white/8 backdrop-blur-md rounded-xl p-3 border border-white/15 hover:bg-white/12 transition-all duration-300 group"
              >
                <div
                  class="w-7 h-7 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform shadow-md shadow-yellow-900/40"
                >
                  <i class="fas fa-network-wired text-white text-xs"></i>
                </div>
                <h4 class="text-xs font-semibold text-white mb-1">
                  Federation
                </h4>
                <p class="text-[11px] text-blue-100 leading-relaxed">
                  Multi-gateway networks with auto-discovery.
                </p>
              </div>

              <!-- Virtual Servers -->
              <div
                class="bg-white/8 backdrop-blur-md rounded-xl p-3 border border-white/15 hover:bg-white/12 transition-all duration-300 group"
              >
                <div
                  class="w-7 h-7 bg-gradient-to-br from-green-400 to-emerald-500 rounded-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform shadow-md shadow-emerald-900/40"
                >
                  <i class="fas fa-server text-white text-xs"></i>
                </div>
                <h4 class="text-xs font-semibold text-white mb-1">
                  Virtual Servers
                </h4>
                <p class="text-[11px] text-blue-100 leading-relaxed">
                  Compose custom MCP endpoints.
                </p>
              </div>

              <!-- Multi-Transport -->
              <div
                class="bg-white/8 backdrop-blur-md rounded-xl p-3 border border-white/15 hover:bg-white/12 transition-all duration-300 group"
              >
                <div
                  class="w-7 h-7 bg-gradient-to-br from-purple-400 to-pink-500 rounded-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform shadow-md shadow-pink-900/40"
                >
                  <i class="fas fa-exchange-alt text-white text-xs"></i>
                </div>
                <h4 class="text-xs font-semibold text-white mb-1">
                  Multi-Transport
                </h4>
                <p class="text-[11px] text-blue-100 leading-relaxed">
                  HTTP, WebSocket, SSE protocols.
                </p>
              </div>
            </div>
          </div>

          <!-- Enterprise Ready grid -->
          <div class="mt-8">
            <h3
              class="text-[11px] font-semibold text-blue-200 uppercase tracking-[0.22em] text-center mb-4"
            >
              Enterprise Ready
            </h3>
            <div class="flex justify-center gap-x-4">

              <!-- Security -->
              <div
                class="bg-white/8 backdrop-blur-md rounded-xl p-3 border border-white/15 hover:bg-white/12 transition-all duration-300 group"
              >
                <div
                  class="w-7 h-7 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform shadow-md shadow-indigo-900/40"
                >
                  <i class="fas fa-shield-alt text-white text-xs"></i>
                </div>
                <h4 class="text-xs font-semibold text-white mb-1">
                  Security
                </h4>
                <p class="text-[11px] text-blue-100 leading-relaxed">
                  JWT auth, Rate limiting, PII &amp; OPA plugins.
                </p>
              </div>

              <!-- Observability -->
              <div
                class="bg-white/8 backdrop-blur-md rounded-xl p-3 border border-white/15 hover:bg-white/12 transition-all duration-300 group"
              >
                <div
                  class="w-7 h-7 bg-gradient-to-br from-red-400 to-pink-500 rounded-lg flex items-center justify-center mb-2 group-hover:scale-110 transition-transform shadow-md shadow-red-900/40"
                >
                  <i class="fas fa-chart-line text-white text-xs"></i>
                </div>
                <h4 class="text-xs font-semibold text-white mb-1">
                  Observability
                </h4>
                <p class="text-[11px] text-blue-100 leading-relaxed">
                  Metrics &amp; comprehensive logging.
                </p>
              </div>

            </div>
          </div>

          <!-- Bottom accent -->
          <div class="mt-4 text-center">
            <div class="inline-flex items-center space-x-4 text-blue-100/80">
              <div class="flex items-center space-x-1">
                <i class="fas fa-check-circle text-green-300 text-xs"></i>
                <span class="text-xs">Production Ready</span>
              </div>
              <div class="flex items-center space-x-1">
                <i class="fas fa-bolt text-yellow-300 text-xs"></i>
                <span class="text-xs">High Performance</span>
              </div>
              <div class="flex items-center space-x-1">
                <i class="fas fa-lock text-blue-300 text-xs"></i>
                <span class="text-xs">Secure by Design</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize ROOT_PATH for JavaScript URL composition
      window.ROOT_PATH = {{ root_path | tojson }};

      // SSO Provider configurations with branding (only GitHub, Google, Microsoft)
      const ssoProviders = {
        github: {
          name: "GitHub",
          icon: "fab fa-github",
          bgColor:
            "bg-slate-900 hover:bg-black text-white dark:bg-gray-800 dark:hover:bg-gray-900",
          textColor: "text-white",
        },
        google: {
          name: "Google",
          icon: "fab fa-google",
          bgColor:
            "bg-white hover:bg-gray-50 dark:bg-gray-700 dark:hover:bg-gray-600",
          textColor: "text-gray-700 dark:text-white",
          border: "border border-gray-300 dark:border-gray-600",
        },
        microsoft: {
          name: "Microsoft Entra ID",
          icon: "fab fa-microsoft",
          bgColor:
            "bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-800",
          textColor: "text-white",
        },
      };

      // Update theme toggle icon based on current theme
      function updateThemeToggleIcon(isDark) {
        const sun = document.getElementById("theme-toggle-sun");
        const moon = document.getElementById("theme-toggle-moon");
        if (!sun || !moon) return;
        if (isDark) {
          sun.classList.add("hidden");
          moon.classList.remove("hidden");
        } else {
          sun.classList.remove("hidden");
          moon.classList.add("hidden");
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", async function () {
        // Initialize theme toggle state
        const isDark = document.documentElement.classList.contains("dark");
        updateThemeToggleIcon(isDark);

        const themeToggle = document.getElementById("theme-toggle");
        if (themeToggle) {
          themeToggle.addEventListener("click", () => {
            const html = document.documentElement;
            const nowDark = html.classList.toggle("dark");
            try {
              localStorage.setItem("theme", nowDark ? "dark" : "light");
            } catch (e) {
              // ignore
            }
            updateThemeToggleIcon(nowDark);
          });
        }

        await loadSSOProviders();
        handleErrorMessages();
        setupAnimations();
      });

      // Load available SSO providers
      async function loadSSOProviders() {
        try {
          const response = await fetch(window.ROOT_PATH + "/auth/sso/providers");

          if (response.status === 404) {
            // SSO not enabled, hide SSO section
            document.getElementById("sso-section").style.display = "none";
            document.getElementById("divider").style.display = "none";
            return;
          }

          if (!response.ok) throw new Error("Failed to load SSO providers");

          const providers = await response.json();
          const ssoContainer = document.getElementById("sso-providers");

          if (providers.length === 0) {
            document.getElementById("sso-section").style.display = "none";
            document.getElementById("divider").style.display = "none";
            return;
          }

          providers.forEach((provider) => {
            const config = ssoProviders[provider.id];
            if (!config) return; // ignore providers we don't want (e.g. okta, ibm_verify)

            const button = document.createElement("button");
            button.type = "button";
            button.onclick = () => initiateSSO(provider.id);
            button.className = `w-full flex justify-center items-center py-3 px-4 rounded-xl font-medium transition-all duration-200 transform hover:-translate-y-0.5 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${config.bgColor} ${config.textColor} ${config.border || ""}`;

            button.innerHTML = `
                    <i class="${config.icon} mr-3 text-lg"></i>
                    Continue with ${config.name}
                    <i class="fas fa-arrow-right ml-auto opacity-0 group-hover:opacity-100 transition-opacity duration-200"></i>
                `;

            button.classList.add("group");
            ssoContainer.appendChild(button);
          });
        } catch (error) {
          console.error("Failed to load SSO providers:", error);
          // Hide SSO section on error
          document.getElementById("sso-section").style.display = "none";
          document.getElementById("divider").style.display = "none";
        }
      }

      // Initiate SSO authentication
      async function initiateSSO(providerId) {
        try {
          const redirectUri =
            window.location.origin +
            window.ROOT_PATH +
            `/auth/sso/callback/${providerId}`;
          const response = await fetch(
            window.ROOT_PATH +
              `/auth/sso/login/${providerId}?redirect_uri=${encodeURIComponent(
                redirectUri,
              )}`,
          );

          if (!response.ok) throw new Error("Failed to initiate SSO");

          const data = await response.json();
          window.location.href = data.authorization_url;
        } catch (error) {
          console.error("SSO initiation failed:", error);
          showError(
            "SSO authentication failed. Please try again or use email/password.",
          );
        }
      }

      // Handle error messages from URL parameters
      function handleErrorMessages() {
        const urlParams = new URLSearchParams(window.location.search);
        const error = urlParams.get("error");

        if (error) {
          let errorMessage = "Login failed";
          switch (error) {
            case "missing_fields":
              errorMessage = "Please provide both email and password";
              break;
            case "invalid_credentials":
              errorMessage = "Invalid email or password";
              break;
            case "admin_required":
              errorMessage = "Admin privileges required";
              break;
            case "server_error":
              errorMessage = "Server error. Please try again";
              break;
            case "sso_failed":
              errorMessage = "SSO authentication failed. Please try again";
              break;
            case "sso_cancelled":
              errorMessage = "SSO authentication was cancelled";
              break;
            default:
              errorMessage = error
                .replace(/_/g, " ")
                .replace(/\b\w/g, (l) => l.toUpperCase());
          }
          showError(errorMessage);
        }
      }

      // Show error message
      function showError(message) {
        const errorDiv = document.getElementById("error-message");
        const errorText = document.getElementById("error-text");
        errorText.textContent = message;
        errorDiv.classList.remove("hidden");

        // Auto-hide after 10 seconds
        setTimeout(() => {
          errorDiv.classList.add("hidden");
        }, 10000);
      }

      // Toggle password visibility
      function togglePassword() {
        const passwordField = document.getElementById("password");
        const passwordIcon = document.getElementById("password-icon");

        if (passwordField.type === "password") {
          passwordField.type = "text";
          passwordIcon.classList.remove("fa-eye");
          passwordIcon.classList.add("fa-eye-slash");
        } else {
          passwordField.type = "password";
          passwordIcon.classList.remove("fa-eye-slash");
          passwordIcon.classList.add("fa-eye");
        }
      }

      // Setup subtle animations
      function setupAnimations() {
        // Add focus animations to inputs
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
          input.addEventListener("focus", function () {
            this.parentNode.classList.add("scale-105");
          });
          input.addEventListener("blur", function () {
            this.parentNode.classList.remove("scale-105");
          });
        });

        // Add loading state to form submission
        const form = document.querySelector("form");
        form.addEventListener("submit", function () {
          const submitBtn = form.querySelector('button[type="submit"]');
          submitBtn.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i>Signing in...';
          submitBtn.disabled = true;
        });
      }

      // Handle SSO callback success
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get("sso") === "success") {
        // Redirect to admin panel after successful SSO
        setTimeout(() => {
          window.location.href = window.ROOT_PATH + "/admin";
        }, 1000);
      }
    </script>
  </body>
</html>
